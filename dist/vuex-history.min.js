!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):t.VuexHistory=e()}(this,function(){"use strict";var i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};function o(t,e){for(var n=e.replace(/\//g,".").replace(/\[(\w+)\]/g,".$1").replace(/^\./,"").split("."),r=t,i=0,o=n.length;i<o;++i){var s=n[i];if(!(s in r))return;r=r[s]}return r}function s(t,e,n){for(var r=e.replace(/\//g,".").replace(/\[(\w+)\]/g,".$1").replace(/^\./,"").split("."),i=t,o=0,s=r.length;o<s;++o){var a=r[o];if(o===s-1)return void(i[a]=n);a in i||(i[a]={}),i=i[a]}}function a(e){var n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:[];if(null===e||"object"!==(void 0===e?"undefined":i(e)))return e;var t=function(t,e){for(var n=t.length,r=0,i=void 0;++r<n;)if(e(i=t[r],r,t))return i}(n,function(t){return t.original===e});if(t)return t.copy;var r=Array.isArray(e)?[]:{};return n.push({original:e,copy:r}),Object.keys(e).forEach(function(t){r[t]=a(e[t],n)}),r}function h(t){return t!==Object(t)}function u(t,e){if(!t)throw new Error("[VueUndoRedo] "+e)}var t=function(){function r(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(t,e,n){return e&&r(t.prototype,e),n&&r(t,n),t}}();var c=void 0;return function(){function r(t,e){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:20;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,r),!c&&"undefined"!=typeof window&&window.Vue&&r.install(window.Vue),"undefined"!=typeof process&&"production"!==process.env.NODE_ENV&&(u(c,"must call Vue.use(VuexHistory) before creating a `history` instance."),u(this instanceof r,"`history` must be called with the new operator.")),this._vm=new c({data:{history:[],historyIndex:0}}),this.maxHistoryLength=n,Object.defineProperty(this,"store",{value:t}),Object.defineProperty(this,"watchStateNames",{value:e}),this.clearHistory()}return t(r,null,[{key:"install",value:function(t){c&&t===c?"production"!==process.env.NODE_ENV&&console.error("[VuexHistory] already installed. Vue.use(VuexHistory) should be called only once."):c=t}}]),t(r,[{key:"clearHistory",value:function(){this._vm.history.length=0,this._vm.historyIndex=-1,this.saveSnapshot()}},{key:"hasDifferenceFromLatest",value:function(){var t=this._vm.history[this._vm.history.length-1];return!function t(e,n){if(e===n)return!0;if(h(e)&&h(n))return e===n;if(Object.keys(e).length!==Object.keys(n).length)return!1;for(var r in e){if(!(r in n))return!1;if(!t(e[r],n[r]))return!1}return!0}(this._currentWatchingState,t)}},{key:"saveSnapshot",value:function(){this._vm.history.length>this.maxHistoryLength&&(this._vm.history.shift(),this._vm.historyIndex=this._vm.history.length-1),this._vm.history.length=this._vm.historyIndex+1,this._vm.history.push(this._currentWatchingState),this._vm.historyIndex++}},{key:"undo",value:function(){if(this.canUndo){this._vm.historyIndex--;var n=a(this.store.state),r=a(this._vm.history[this._vm.historyIndex]);this.watchStateNames.forEach(function(t){var e=o(r,t);s(n,t,e)}),this.store.replaceState(n)}}},{key:"redo",value:function(){if(this.canRedo){this._vm.historyIndex++;var n=a(this.store.state),r=a(this._vm.history[this._vm.historyIndex]);this.watchStateNames.forEach(function(t){var e=o(r,t);s(n,t,e)}),this.store.replaceState(n)}}},{key:"_currentWatchingState",get:function(){var n=a(this.store.state),r={};return this.watchStateNames.forEach(function(t){var e=o(n,t);s(r,t,e)}),r}},{key:"history",set:function(t){this._vm.$data.history=t}},{key:"canUndo",get:function(){return 0<this._vm.historyIndex}},{key:"canRedo",get:function(){return this._vm.historyIndex<this._vm.history.length-1}}]),r}()});
